<html layout:decorator="layouts/navbar_layout">
<body>
	<th:block layout:fragment="content">
		<div id="page-wrapper">
			<div class="row">
				<div class="col-lg-12">
					<h1 class="page-header">
						<i class="fa fa-tachometer"></i><span>Transaction Graphs</span>
					</h1>
				</div>
			</div>

			<div class="row">
				<div class="col-lg-12">
					<div id="chart2"
						style="margin-top: 20px; margin-right: 40px; width: 100%; height: 100%">
							<button id="export" class="btn btn-primary"
									style="float: right;">Download All</button>										
						</div>
				</div>

			</div>


			<div class="row">
				<div class="col-lg-12">
					<div id="ussdgraphcontainer" style="width: 100%; height: 600px"></div>

				</div>

			</div>
			
			<div class="row">
				<div class="col-lg-12">
					<div id="ussdgraphcontainerHour" style="width: 100%; height: 600px"></div>

				</div>

			</div>
			
			<div class="row">
				<div class="col-lg-12">
					<div id="ppfegraphcontainer"
						style="width: 100%; height: 600px"></div>
				</div>

			</div>
			
			<div class="row">
				<div class="col-lg-12">
					<div id="ppfegraphcontainerHour"
						style="width: 100%; height: 600px"></div>
				</div>

			</div>
			
			<div class="row">
				<div class="col-lg-12">
					<div id="ccrgraphcontainer" style="width: 100%; height: 600px"></div>
				</div>

			</div>
			
			<div class="row">
				<div class="col-lg-12">
					<div id="ccrgraphcontainerHour" style="width: 100%; height: 600px"></div>
				</div>

			</div>
			
		</div>

		<script th:inline="javascript">
		
			/*<![CDATA[*/
			$(function() {
				
				var ussdTransactionList = /*[[${ussdTransactionViews}]]*/;
				var ussdTransactionListHour = /*[[${ussdTransactionViewsHour}]]*/;
				
				var ccrTransactionList = /*[[${ccrTransactionViews}]]*/;
				var ccrTransactionListHour = /*[[${ccrTransactionHourViews}]]*/;
				
				var ppfeTransactionList = /*[[${ppfeTransactionViews}]]*/;
				var ppfeTransactionListHour = /*[[${ppfeTransactionHourViews}]]*/;
				
                $('#start-date').datetimepicker({
                    useCurrent : true,
                    icons : {
                        date : 'fa fa-calendar'
                    },
                    pickTime : false,
                    showToday : true
                });

                $('#end-date').datetimepicker({
                    useCurrent : true,
                    icons : {
                        date : 'fa fa-calendar'
                    },
                    pickTime : false,
                    showToday : true
                });
				
				var intervalsSelect = $('#intervals');
				
				intervalsSelect.selectbox('attach');
				
				if(ussdTransactionList != null) {
					
					var intervals = [], transactionVolumes = [], latency = [], percReqInSLAs = [], percRequestsInSLAValue2 = [], percRequestsInSLAValue3 = [],percRequestsInSLAValue4 = [], sla = [];
					
				    $.each(ussdTransactionList, function(i,transactionCountView){
				    	
				    	
				    	
				    	//highcharts
				    	intervals.push(transactionCountView.requestDate);
	                    transactionVolumes.push(transactionCountView.transactionCount);
	                    latency.push(transactionCountView.latency);
	                    
	                    if(transactionCountView.inSlaPerc600 > 0) {
		                    percReqInSLAs.push(transactionCountView.inSlaPerc600);	                    	
	                    }
	                    
	                    if(transactionCountView.inSlaPerc700 > 0) {
		                    percRequestsInSLAValue2.push(transactionCountView.inSlaPerc700);	                    	
	                    }
	                    
	                    if(transactionCountView.inSlaPerc800 > 0) {
		                    percRequestsInSLAValue3.push(transactionCountView.inSlaPerc800);	                    	
	                    }
	                    
	                    if(transactionCountView.inSlaPerc900 > 0) {
		                    percRequestsInSLAValue4.push(transactionCountView.inSlaPerc900);	                    	
	                    }
	                    
	                    sla.push(95);
				    					        
				    });
				    

				    var ussdDailyChart = Highcharts.chart('ussdgraphcontainer',
		            /*$('#ussdgraphcontainer')
                        .highcharts(*/
                            {
                                chart : {
                                    zoomType : 'xy',
                                    events: {
                                        addSeries: function() {
                                          var c = this;
                                          setTimeout(function(){c.xAxis[0].setExtremes(c.xAxis[0].dataMin, c.xAxis[0].dataMax)}, 10);
                                        },
                                        load: function() {
                                          var c = this;
                                          setTimeout(function(){c.xAxis[0].setExtremes(c.xAxis[0].dataMin, c.xAxis[0].dataMax)}, 10);
                                        }
                                      }
                                },
                                title : {
                                    text : 'USSD Transaction Count Daily statistics'
                                },
                                subtitle : {
                                    text : 'Source: CDM_KPI Database'
                                },
                                xAxis : [ {
                                    categories : intervals,
                                    labels : {
                                    	overflow: false,
                                    	rotation: -70,
                                        align: 'right',
                                        style: {
                                        	lineHeight: 10
                                        }
                                    },
                                    events: {
                                        setExtremes: function (event) {
                                          if (Math.abs(this.options.labels.rotation) == 90) {
                                            var labelWidth = parseInt(this.options.labels.style.lineHeight) + 2;
                                            var plotAreaWidth = parseInt(this.chart.plotBox.width);
                                            var labelsCount = Math.floor(plotAreaWidth / labelWidth);
                                            if (event.max !== null && event.max !== undefined) {
                                              var pointsCount = Math.round(event.max - event.min);
                                            } else {
                                              var pointsCount = Math.round(this.dataMax - this.dataMin);
                                            }
                                            var step = Math.ceil(pointsCount / (labelsCount * (this.tickInterval == null ? 1 : this.tickInterval)));
                                            this.update({'labels': {'step': step}}, true);
                                          }
                                        }
                                      }
                                } ],
                                yAxis : [
                                        { // Primary yAxis
                                            labels : {
                                                format : '{value} n',
                                                style : {
                                                    color : '#0066FF'
                                                    /* Highcharts
                                                            .getOptions().colors[2] */
                                                }
                                            },
                                            title : {
                                                text : 'Transaction Count',
                                                style : {
                                                    color : '#0066FF'
                                                        /* Highcharts
                                                        .getOptions().colors[2] */
                                                }
                                            },
                                            opposite : false

                                        },
                                        { // Secondary yAxis
                                            gridLineWidth : 0,
                                            title : {
                                                text : '% Requests meeting SLAs',
                                                style : {
                                                    color : '#0066FF'
                                                        /* Highcharts
                                                        .getOptions().colors[2] */
                                                }
                                            },
                                            labels : {
                                                format : '{value} %',
                                                style : {
                                                    color : '#0066FF'
                                                        /* Highcharts
                                                        .getOptions().colors[2] */
                                                }
                                            },
                                            endOnTick: false,
                                            opposite : true,                                            
                                            max : 100

                                        }],
                                tooltip : {
                                    shared : true
                                },
                                /* legend : {
                                    layout : 'vertical',
                                    align : 'right',
                                    x : 450,
                                    verticalAlign : 'top',
                                    y : 120,
                                    floating : true,
                                    backgroundColor : (Highcharts.theme && Highcharts.theme.legendBackgroundColor)
                                            || '#FFFFFF'
                                }, */
                                series : [
                                        {
                                            name : 'Transaction Count',
                                            type : 'column',
                                            yAxis : 0,
                                            data : transactionVolumes,
                                            tooltip : {
                                                valueSuffix : ''
                                            }
                                        },
                                        {
                                            name : 'Sla 600ms',
                                            color: 'red',
                                            type : 'line',
                                            yAxis : 1,
                                            data : percReqInSLAs,
                                            marker : {
                                                enabled : false
                                            },
                                            tooltip : {
                                                valueSuffix : ' %'
                                            }

                                        },
                                        {
                                            name : 'Sla 700ms',
                                            color: 'green',
                                            type : 'line',
                                            yAxis : 1,
                                            data : percRequestsInSLAValue2,
                                            marker : {
                                                enabled : false
                                            },
                                            tooltip : {
                                                valueSuffix : ' %'
                                            }

                                        },
                                        {
                                            name : 'Sla 800ms',
                                            color: 'purple',
                                            type : 'line',
                                            yAxis : 1,
                                            data : percRequestsInSLAValue3,
                                            marker : {
                                                enabled : false
                                            },
                                            tooltip : {
                                                valueSuffix : ' %'
                                            }

                                        },
                                        {
                                            name : 'Sla 900ms',
                                            color: 'brown',
                                            type : 'line',
                                            yAxis : 1,
                                            data : percRequestsInSLAValue4,
                                            marker : {
                                                enabled : false
                                            },
                                            tooltip : {
                                                valueSuffix : ' %'
                                            }

                                        },
                                        {
                                        	name : 'Sla',
                                            color: 'blue',
                                            type : 'line',
                                            dashStyle: 'ShortDot',
                                            yAxis : 1,
                                            data : sla,
                                            marker : {
                                                enabled : false
                                            },
                                            tooltip : {
                                                valueSuffix : ' %'
                                            }

                                        }],
                                		exporting: {                                	        
                                			sourceWidth: 1300,
                                			sourceHeight: 600
                                		}
                            });
		            
				}
				
				
				
					if(ussdTransactionListHour != null) {
					
					var intervals = [], transactionVolumes = [], latency = [], percReqInSLAs = [], percRequestsInSLAValue2 = [], percRequestsInSLAValue3 = [],percRequestsInSLAValue4 = [], sla = [];
					
				    $.each(ussdTransactionListHour, function(i,transactionCountView){
				    	
				    	
				    	
				    	//highcharts
				    	intervals.push(transactionCountView.requestDate);
	                    transactionVolumes.push(transactionCountView.transactionCount);
	                    latency.push(transactionCountView.latency);
	                    
	                    if(transactionCountView.inSlaPerc600 > 0) {
		                    percReqInSLAs.push(transactionCountView.inSlaPerc600);	                    	
	                    }
	                    
	                    if(transactionCountView.inSlaPerc700 > 0) {
		                    percRequestsInSLAValue2.push(transactionCountView.inSlaPerc700);	                    	
	                    }
	                    
	                    if(transactionCountView.inSlaPerc800 > 0) {
		                    percRequestsInSLAValue3.push(transactionCountView.inSlaPerc800);	                    	
	                    }
	                    
	                    if(transactionCountView.inSlaPerc900 > 0) {
		                    percRequestsInSLAValue4.push(transactionCountView.inSlaPerc900);	                    	
	                    }
	                    
	                    sla.push(95);
				    	
				        
				    });
				    

				    var ussdHourlyChart = Highcharts.chart('ussdgraphcontainerHour',
		            /*$('#ussdgraphcontainerHour')
                        .highcharts(*/
                            {
                                chart : {
                                    zoomType : 'xy',
                                    events: {
                                        addSeries: function() {
                                          var c = this;
                                          setTimeout(function(){c.xAxis[0].setExtremes(c.xAxis[0].dataMin, c.xAxis[0].dataMax)}, 10);
                                        },
                                        load: function() {
                                          var c = this;
                                          setTimeout(function(){c.xAxis[0].setExtremes(c.xAxis[0].dataMin, c.xAxis[0].dataMax)}, 10);
                                        }
                                      }
                                },
                                title : {
                                    text : 'USSD Transaction Count Hourly Statistics'
                                },
                                subtitle : {
                                    text : 'Source: CDM_KPI Database'
                                },
                                xAxis : [ {
                                    categories : intervals,
                                    labels : {
                                    	overflow: false,
                                    	rotation: -70,
                                        align: 'right',
                                        style: {
                                        	lineHeight: 10
                                        }
                                    },
                                    events: {
                                        setExtremes: function (event) {
                                          if (Math.abs(this.options.labels.rotation) == 90) {
                                            var labelWidth = parseInt(this.options.labels.style.lineHeight) + 2;
                                            var plotAreaWidth = parseInt(this.chart.plotBox.width);
                                            var labelsCount = Math.floor(plotAreaWidth / labelWidth);
                                            if (event.max !== null && event.max !== undefined) {
                                              var pointsCount = Math.round(event.max - event.min);
                                            } else {
                                              var pointsCount = Math.round(this.dataMax - this.dataMin);
                                            }
                                            var step = Math.ceil(pointsCount / (labelsCount * (this.tickInterval == null ? 1 : this.tickInterval)));
                                            this.update({'labels': {'step': step}}, true);
                                          }
                                        }
                                      }
                                } ],
                                yAxis : [
                                        { // Primary yAxis
                                            labels : {
                                                format : '{value} n',
                                                style : {
                                                    color : '#0066FF'
                                                    /* Highcharts
                                                            .getOptions().colors[2] */
                                                }
                                            },
                                            title : {
                                                text : 'Transaction Count',
                                                style : {
                                                    color : '#0066FF'
                                                        /* Highcharts
                                                        .getOptions().colors[2] */
                                                }
                                            },
                                            opposite : false

                                        },
                                        { // Secondary yAxis
                                            gridLineWidth : 0,
                                            title : {
                                                text : '% Requests meeting SLAs',
                                                style : {
                                                    color : '#0066FF'
                                                        /* Highcharts
                                                        .getOptions().colors[2] */
                                                }
                                            },
                                            labels : {
                                                format : '{value} %',
                                                style : {
                                                    color : '#0066FF'
                                                        /* Highcharts
                                                        .getOptions().colors[2] */
                                                }
                                            },
                                            endOnTick: false,
                                            opposite : true,
											max: 100
                                        }],
                                tooltip : {
                                    shared : true
                                },
                                /* legend : {
                                    layout : 'vertical',
                                    align : 'right',
                                    x : 450,
                                    verticalAlign : 'top',
                                    y : 120,
                                    floating : true,
                                    backgroundColor : (Highcharts.theme && Highcharts.theme.legendBackgroundColor)
                                            || '#FFFFFF'
                                }, */
                                series : [
                                        {
                                            name : 'Transaction Count',
                                            type : 'column',
                                            yAxis : 0,
                                            data : transactionVolumes,
                                            tooltip : {
                                                valueSuffix : ''
                                            }

                                        },
                                        {
                                            name : 'Sla 600ms',
                                            color: 'red',
                                            type : 'line',
                                            yAxis : 1,
                                            data : percReqInSLAs,
                                            marker : {
                                                enabled : false
                                            },
                                            tooltip : {
                                                valueSuffix : ' %'
                                            }

                                        },
                                        {
                                            name : 'Sla 700ms',
                                            color: 'green',
                                            type : 'line',
                                            yAxis : 1,
                                            data : percRequestsInSLAValue2,
                                            marker : {
                                                enabled : false
                                            },
                                            tooltip : {
                                                valueSuffix : ' %'
                                            }

                                        },
                                        {
                                            name : 'Sla 800ms',
                                            color: 'purple',
                                            type : 'line',
                                            yAxis : 1,
                                            data : percRequestsInSLAValue3,
                                            marker : {
                                                enabled : false
                                            },
                                            tooltip : {
                                                valueSuffix : ' %'
                                            }

                                        },
                                        {
                                            name : 'Sla 900ms',
                                            color: 'brown',
                                            type : 'line',
                                            yAxis : 1,
                                            data : percRequestsInSLAValue4,
                                            marker : {
                                                enabled : false
                                            },
                                            tooltip : {
                                                valueSuffix : ' %'
                                            }

                                        },
                                        {
                                        	name : 'Sla',
                                            color: 'blue',
                                            type : 'line',
                                            dashStyle: 'ShortDot',
                                            yAxis : 1,
                                            data : sla,
                                            marker : {
                                                enabled : false
                                            },
                                            tooltip : {
                                                valueSuffix : ' %'
                                            }
                                        }],
                                		exporting: {
                                			sourceWidth: 1300,
                                			sourceHeight: 600
                                		}
                            });
		            
				}

					if(ccrTransactionList != null) {
	                    
	                    var intervals = [], transactionVolumes = [], latency = [], percReqInSLAs = [], percRequestsInSLAValue2 = [], percRequestsInSLAValue3 = [],percRequestsInSLAValue4 = [], sla = [];
	                    
	                    $.each(ccrTransactionList, function(i,transactionCountView){
	                        
	                        
	                        
	                        //highcharts
	                        intervals.push(transactionCountView.requestDate);
	                        transactionVolumes.push(transactionCountView.transactionCount);
	                        latency.push(transactionCountView.latency);
	                        
	                        if(transactionCountView.inSlaPerc600 > 0) {
	                            percReqInSLAs.push(transactionCountView.inSlaPerc600);                            
	                        }
	                        
	                        if(transactionCountView.inSlaPerc700 > 0) {
	                            percRequestsInSLAValue2.push(transactionCountView.inSlaPerc700);                         
	                        }
	                        
	                        if(transactionCountView.inSlaPerc800 > 0) {
	                            percRequestsInSLAValue3.push(transactionCountView.inSlaPerc800);                         
	                        }
	                        
	                        if(transactionCountView.inSlaPerc900 > 0) {
	                            percRequestsInSLAValue4.push(transactionCountView.inSlaPerc900);                         
	                        }
	                        
	                        sla.push(95);
	                        
	                        
	                    });
	                    

	                    var ccrDailyChart = Highcharts.chart('ccrgraphcontainer',
	                    /*$('#ccrgraphcontainer')
	                        .highcharts(*/
	                            {
	                                chart : {
	                                    zoomType : 'xy',
	                                    events: {
	                                        addSeries: function() {
	                                          var c = this;
	                                          setTimeout(function(){c.xAxis[0].setExtremes(c.xAxis[0].dataMin, c.xAxis[0].dataMax)}, 10);
	                                        },
	                                        load: function() {
	                                          var c = this;
	                                          setTimeout(function(){c.xAxis[0].setExtremes(c.xAxis[0].dataMin, c.xAxis[0].dataMax)}, 10);
	                                        }
	                                      }
	                                },
	                                title : {
	                                    text : 'CCR Transaction Count Daily statistics'
	                                },
	                                subtitle : {
	                                    text : 'Source: CDM_KPI Database'
	                                },
	                                xAxis : [ {
	                                    categories : intervals,
	                                    labels : {
	                                        overflow: false,
	                                        rotation: -70,
	                                        align: 'right',
	                                        style: {
	                                            lineHeight: 10
	                                        }
	                                    },
	                                    events: {
	                                        setExtremes: function (event) {
	                                          if (Math.abs(this.options.labels.rotation) == 90) {
	                                            var labelWidth = parseInt(this.options.labels.style.lineHeight) + 2;
	                                            var plotAreaWidth = parseInt(this.chart.plotBox.width);
	                                            var labelsCount = Math.floor(plotAreaWidth / labelWidth);
	                                            if (event.max !== null && event.max !== undefined) {
	                                              var pointsCount = Math.round(event.max - event.min);
	                                            } else {
	                                              var pointsCount = Math.round(this.dataMax - this.dataMin);
	                                            }
	                                            var step = Math.ceil(pointsCount / (labelsCount * (this.tickInterval == null ? 1 : this.tickInterval)));
	                                            this.update({'labels': {'step': step}}, true);
	                                          }
	                                        }
	                                      }
	                                } ],
	                                yAxis : [
	                                        { // Primary yAxis
	                                            labels : {
	                                                format : '{value}',
	                                                style : {
	                                                    color : '#0066FF'
	                                                    /* Highcharts
	                                                            .getOptions().colors[2] */
	                                                }
	                                            },
	                                            title : {
	                                                text : 'Transaction Count',
	                                                style : {
	                                                    color : '#0066FF'
	                                                        /* Highcharts
	                                                        .getOptions().colors[2] */
	                                                }
	                                            },
	                                            opposite : false

	                                        },
	                                        { // Secondary yAxis
	                                            gridLineWidth : 0,
	                                            title : {
	                                                text : '% Requests meeting SLAs',
	                                                style : {
	                                                    color : '#0066FF'
	                                                        /* Highcharts
	                                                        .getOptions().colors[2] */
	                                                }
	                                            },
	                                            labels : {
	                                                format : '{value} %',
	                                                style : {
	                                                    color : '#0066FF'
	                                                        /* Highcharts
	                                                        .getOptions().colors[2] */
	                                                }
	                                            },
	                                            endOnTick: false,
	                                            opposite : true,
	                                            max: 100

	                                        }],
	                                tooltip : {
	                                    shared : true
	                                },
	                                /* legend : {
	                                    layout : 'vertical',
	                                    align : 'right',
	                                    x : 450,
	                                    verticalAlign : 'top',
	                                    y : 120,
	                                    floating : true,
	                                    backgroundColor : (Highcharts.theme && Highcharts.theme.legendBackgroundColor)
	                                            || '#FFFFFF'
	                                }, */
	                                series : [
	                                        {
	                                            name : 'Transaction Count',
	                                            type : 'column',
	                                            yAxis : 0,
	                                            data : transactionVolumes,
	                                            tooltip : {
	                                                valueSuffix : ''
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla 600ms',
	                                            color: 'red',
	                                            type : 'line',
	                                            yAxis : 1,
	                                            data : percReqInSLAs,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla 700ms',
	                                            color: 'green',
	                                            type : 'line',
	                                            yAxis : 1,
	                                            data : percRequestsInSLAValue2,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla 800ms',
	                                            color: 'purple',
	                                            type : 'line',
	                                            yAxis : 1,
	                                            data : percRequestsInSLAValue3,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla 900ms',
	                                            color: 'brown',
	                                            type : 'line',
	                                            yAxis : 1,
	                                            data : percRequestsInSLAValue4,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla',
	                                            color: 'blue',
	                                            type : 'line',
	                                            dashStyle: 'ShortDot',
	                                            yAxis : 1,
	                                            data : sla,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }
	                                        }],
                                    		exporting: {                                	        
                                    			sourceWidth: 1300,
                                    			sourceHeight: 600
                                    		}
	                            });
	                    
	                }
					
					
if(ccrTransactionListHour != null) {
	                    
	                    var intervals = [], transactionVolumes = [], latency = [], percReqInSLAs = [], percRequestsInSLAValue2 = [], percRequestsInSLAValue3 = [],percRequestsInSLAValue4 = [], sla = [];
	                    
	                    $.each(ccrTransactionListHour, function(i,transactionCountView){
	                        
	                        
	                        
	                        //highcharts
	                        intervals.push(transactionCountView.requestDate);
	                        transactionVolumes.push(transactionCountView.transactionCount);
	                        latency.push(transactionCountView.latency);
	                        
	                        if(transactionCountView.inSlaPerc600 > 0) {
	                            percReqInSLAs.push(transactionCountView.inSlaPerc600);                            
	                        }
	                        
	                        if(transactionCountView.inSlaPerc700 > 0) {
	                            percRequestsInSLAValue2.push(transactionCountView.inSlaPerc700);                         
	                        }
	                        
	                        if(transactionCountView.inSlaPerc800 > 0) {
	                            percRequestsInSLAValue3.push(transactionCountView.inSlaPerc800);                         
	                        }
	                        
	                        if(transactionCountView.inSlaPerc900 > 0) {
	                            percRequestsInSLAValue4.push(transactionCountView.inSlaPerc900);                         
	                        }
	                        
	                        sla.push(95);
	                        
	                        
	                    });
	                    

	                    var ccrHourlyChart = Highcharts.chart('ccrgraphcontainerHour',
	                    /*$('#ccrgraphcontainerHour')
	                        .highcharts(*/
	                            {
	                                chart : {
	                                    zoomType : 'xy',
	                                    events: {
	                                        addSeries: function() {
	                                          var c = this;
	                                          setTimeout(function(){c.xAxis[0].setExtremes(c.xAxis[0].dataMin, c.xAxis[0].dataMax)}, 10);
	                                        },
	                                        load: function() {
	                                          var c = this;
	                                          setTimeout(function(){c.xAxis[0].setExtremes(c.xAxis[0].dataMin, c.xAxis[0].dataMax)}, 10);
	                                        }
	                                      }
	                                },
	                                title : {
	                                    text : 'CCR Transaction Count Hourly Statistics'
	                                },
	                                subtitle : {
	                                    text : 'Source: CDM_KPI Database'
	                                },
	                                xAxis : [ {
	                                    categories : intervals,
	                                    labels : {
	                                        overflow: false,
	                                        rotation: -70,
	                                        align: 'right',
	                                        style: {
	                                            lineHeight: 10
	                                        }
	                                    },
	                                    events: {
	                                        setExtremes: function (event) {
	                                          if (Math.abs(this.options.labels.rotation) == 90) {
	                                            var labelWidth = parseInt(this.options.labels.style.lineHeight) + 2;
	                                            var plotAreaWidth = parseInt(this.chart.plotBox.width);
	                                            var labelsCount = Math.floor(plotAreaWidth / labelWidth);
	                                            if (event.max !== null && event.max !== undefined) {
	                                              var pointsCount = Math.round(event.max - event.min);
	                                            } else {
	                                              var pointsCount = Math.round(this.dataMax - this.dataMin);
	                                            }
	                                            var step = Math.ceil(pointsCount / (labelsCount * (this.tickInterval == null ? 1 : this.tickInterval)));
	                                            this.update({'labels': {'step': step}}, true);
	                                          }
	                                        }
	                                      }
	                                } ],
	                                yAxis : [
	                                        { // Primary yAxis
	                                            labels : {
	                                                format : '{value}',
	                                                style : {
	                                                    color : '#0066FF'
	                                                    /* Highcharts
	                                                            .getOptions().colors[2] */
	                                                }
	                                            },
	                                            title : {
	                                                text : 'Transaction Count',
	                                                style : {
	                                                    color : '#0066FF'
	                                                        /* Highcharts
	                                                        .getOptions().colors[2] */
	                                                }
	                                            },
	                                            opposite : false

	                                        },
	                                        { // Secondary yAxis
	                                            gridLineWidth : 0,
	                                            title : {
	                                                text : '% Requests meeting SLAs',
	                                                style : {
	                                                    color : '#0066FF'
	                                                        /* Highcharts
	                                                        .getOptions().colors[2] */
	                                                }
	                                            },
	                                            labels : {
	                                                format : '{value} %',
	                                                style : {
	                                                    color : '#0066FF'
	                                                        /* Highcharts
	                                                        .getOptions().colors[2] */
	                                                }
	                                            },
	                                            endOnTick: false,
	                                            opposite : true,
	                                            max: 100

	                                        }],
	                                tooltip : {
	                                    shared : true
	                                },
	                                /* legend : {
	                                    layout : 'vertical',
	                                    align : 'right',
	                                    x : 450,
	                                    verticalAlign : 'top',
	                                    y : 120,
	                                    floating : true,
	                                    backgroundColor : (Highcharts.theme && Highcharts.theme.legendBackgroundColor)
	                                            || '#FFFFFF'
	                                }, */
	                                series : [
	                                        {
	                                            name : 'Transaction Count',
	                                            type : 'column',
	                                            yAxis : 0,
	                                            data : transactionVolumes,
	                                            tooltip : {
	                                                valueSuffix : ''
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla 600ms',
	                                            color: 'red',
	                                            type : 'line',
	                                            yAxis : 1,
	                                            data : percReqInSLAs,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla 700ms',
	                                            color: 'green',
	                                            type : 'line',
	                                            yAxis : 1,
	                                            data : percRequestsInSLAValue2,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla 800ms',
	                                            color: 'purple',
	                                            type : 'line',
	                                            yAxis : 1,
	                                            data : percRequestsInSLAValue3,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla 900ms',
	                                            color: 'brown',
	                                            type : 'line',
	                                            yAxis : 1,
	                                            data : percRequestsInSLAValue4,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla',
	                                            color: 'blue',
	                                            type : 'line',
	                                            dashStyle: 'ShortDot',
	                                            yAxis : 1,
	                                            data : sla,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }
	                                        }],
                                    		exporting: {                                	        
                                    			sourceWidth: 1300,
                                    			sourceHeight: 600
                                    		}
	                            });
	                    
	                }
				    
				    if(ppfeTransactionList != null) {
	                    
	                    var intervals = [], transactionVolumes = [], latency = [], percReqInSLAs = [], percRequestsInSLAValue2 = [], percRequestsInSLAValue3 = [],percRequestsInSLAValue4 = [], sla = [];
	                    
	                    $.each(ppfeTransactionList, function(i,transactionCountView){
	                        
	                        
	                        
	                        //highcharts
	                        intervals.push(transactionCountView.requestDate);
	                        transactionVolumes.push(transactionCountView.transactionCount);
	                        latency.push(transactionCountView.latency);
	                        
	                        if(transactionCountView.inSlaPerc600 > 0) {
	                            percReqInSLAs.push(transactionCountView.inSlaPerc600);                            
	                        }
	                        
	                        if(transactionCountView.inSlaPerc700 > 0) {
	                            percRequestsInSLAValue2.push(transactionCountView.inSlaPerc700);                         
	                        }
	                        
	                        if(transactionCountView.inSlaPerc800 > 0) {
	                            percRequestsInSLAValue3.push(transactionCountView.inSlaPerc800);                         
	                        }
	                        
	                        if(transactionCountView.inSlaPerc900 > 0) {
	                            percRequestsInSLAValue4.push(transactionCountView.inSlaPerc900);                         
	                        }
	                        
	                        sla.push(95);
	                        
	                        
	                    });
	                    

	                    var ppfeDailyChart = Highcharts.chart('ppfegraphcontainer',
	                    /*$('#ppfegraphcontainer')
	                        .highcharts(*/
	                            {
	                                chart : {
	                                    zoomType : 'xy',
	                                    events: {
	                                        addSeries: function() {
	                                          var c = this;
	                                          setTimeout(function(){c.xAxis[0].setExtremes(c.xAxis[0].dataMin, c.xAxis[0].dataMax)}, 10);
	                                        },
	                                        load: function() {
	                                          var c = this;
	                                          setTimeout(function(){c.xAxis[0].setExtremes(c.xAxis[0].dataMin, c.xAxis[0].dataMax)}, 10);
	                                        }
	                                      }
	                                },
	                                title : {
	                                    text : 'PPFE Transaction Count Daily statistics'
	                                },
	                                subtitle : {
	                                    text : 'Source: CDM_KPI Database'
	                                },
	                                xAxis : [ {
	                                    categories : intervals,
	                                    labels : {
	                                        overflow: false,
	                                        rotation: -70,
	                                        align: 'right',
	                                        style: {
	                                            lineHeight: 10
	                                        }
	                                    },
	                                    events: {
	                                        setExtremes: function (event) {
	                                          if (Math.abs(this.options.labels.rotation) == 90) {
	                                            var labelWidth = parseInt(this.options.labels.style.lineHeight) + 2;
	                                            var plotAreaWidth = parseInt(this.chart.plotBox.width);
	                                            var labelsCount = Math.floor(plotAreaWidth / labelWidth);
	                                            if (event.max !== null && event.max !== undefined) {
	                                              var pointsCount = Math.round(event.max - event.min);
	                                            } else {
	                                              var pointsCount = Math.round(this.dataMax - this.dataMin);
	                                            }
	                                            var step = Math.ceil(pointsCount / (labelsCount * (this.tickInterval == null ? 1 : this.tickInterval)));
	                                            this.update({'labels': {'step': step}}, true);
	                                          }
	                                        }
	                                      }
	                                } ],
	                                yAxis : [
	                                        { // Primary yAxis
	                                            labels : {
	                                                format : '{value}',
	                                                style : {
	                                                    color : '#0066FF'
	                                                    /* Highcharts
	                                                            .getOptions().colors[2] */
	                                                }
	                                            },
	                                            title : {
	                                                text : 'Transaction Count',
	                                                style : {
	                                                    color : '#0066FF'
	                                                        /* Highcharts
	                                                        .getOptions().colors[2] */
	                                                }
	                                            },
	                                            opposite : false

	                                        },
	                                        { // Secondary yAxis
	                                            gridLineWidth : 0,
	                                            title : {
	                                                text : '% Requests meeting SLAs',
	                                                style : {
	                                                    color : '#0066FF'
	                                                        /* Highcharts
	                                                        .getOptions().colors[2] */
	                                                }
	                                            },
	                                            labels : {
	                                                format : '{value} %',
	                                                style : {
	                                                    color : '#0066FF'
	                                                        /* Highcharts
	                                                        .getOptions().colors[2] */
	                                                }
	                                            },
	                                            endOnTick: false,
	                                            opposite : true,
	                                            max: 100

	                                        }],
	                                tooltip : {
	                                    shared : true
	                                },
	                                /* legend : {
	                                    layout : 'vertical',
	                                    align : 'right',
	                                    x : 450,
	                                    verticalAlign : 'top',
	                                    y : 120,
	                                    floating : true,
	                                    backgroundColor : (Highcharts.theme && Highcharts.theme.legendBackgroundColor)
	                                            || '#FFFFFF'
	                                }, */
	                                series : [
	                                        {
	                                            name : 'Transaction Count',
	                                            type : 'column',
	                                            yAxis : 0,
	                                            data : transactionVolumes,
	                                            tooltip : {
	                                                valueSuffix : ''
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla 600ms',
	                                            color: 'red',
	                                            type : 'line',
	                                            yAxis : 1,
	                                            data : percReqInSLAs,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla 700ms',
	                                            color: 'green',
	                                            type : 'line',
	                                            yAxis : 1,
	                                            data : percRequestsInSLAValue2,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla 800ms',
	                                            color: 'purple',
	                                            type : 'line',
	                                            yAxis : 1,
	                                            data : percRequestsInSLAValue3,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla 900ms',
	                                            color: 'brown',
	                                            type : 'line',
	                                            yAxis : 1,
	                                            data : percRequestsInSLAValue4,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla',
	                                            color: 'blue',
	                                            type : 'line',
	                                            dashStyle: 'ShortDot',
	                                            yAxis : 1,
	                                            data : sla,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        }],
	                                		exporting: {                                	        
	                                			sourceWidth: 1300,
	                                			sourceHeight: 600
	                                		}
	                            });
	                    
	                }
				    
					if(ppfeTransactionListHour != null) {
	                    
	                    var intervals = [], transactionVolumes = [], latency = [], percReqInSLAs = [], percRequestsInSLAValue2 = [], percRequestsInSLAValue3 = [],percRequestsInSLAValue4 = [], sla = [];
	                    
	                    $.each(ppfeTransactionListHour, function(i,transactionCountView){
	                        
	                        
	                        
	                        //highcharts
	                        intervals.push(transactionCountView.requestDate);
	                        transactionVolumes.push(transactionCountView.transactionCount);
	                        latency.push(transactionCountView.latency);
	                        
	                        if(transactionCountView.inSlaPerc600 > 0) {
	                            percReqInSLAs.push(transactionCountView.inSlaPerc600);                            
	                        }
	                        
	                        if(transactionCountView.inSlaPerc700 > 0) {
	                            percRequestsInSLAValue2.push(transactionCountView.inSlaPerc700);                         
	                        }
	                        
	                        if(transactionCountView.inSlaPerc800 > 0) {
	                            percRequestsInSLAValue3.push(transactionCountView.inSlaPerc800);                         
	                        }
	                        
	                        if(transactionCountView.inSlaPerc900 > 0) {
	                            percRequestsInSLAValue4.push(transactionCountView.inSlaPerc900);                         
	                        }
	                        
	                        sla.push(95);
	                        
	                        
	                    });
	                    

	                    var ppfeHourlyChart = Highcharts.chart('ppfegraphcontainerHour',
	                    /*$('#ppfegraphcontainerHour')
	                        .highcharts(*/
	                            {
	                                chart : {
	                                    zoomType : 'xy',
	                                    events: {
	                                        addSeries: function() {
	                                          var c = this;
	                                          setTimeout(function(){c.xAxis[0].setExtremes(c.xAxis[0].dataMin, c.xAxis[0].dataMax)}, 10);
	                                        },
	                                        load: function() {
	                                          var c = this;
	                                          setTimeout(function(){c.xAxis[0].setExtremes(c.xAxis[0].dataMin, c.xAxis[0].dataMax)}, 10);
	                                        }
	                                      }
	                                },
	                                title : {
	                                    text : 'PPFE Transaction Count Hourly Statistics'
	                                },
	                                subtitle : {
	                                    text : 'Source: CDM_KPI Database'
	                                },
	                                xAxis : [ {
	                                    categories : intervals,
	                                    labels : {
	                                        overflow: false,
	                                        rotation: -70,
	                                        align: 'right',
	                                        style: {
	                                            lineHeight: 10
	                                        }
	                                    },
	                                    events: {
	                                        setExtremes: function (event) {
	                                          if (Math.abs(this.options.labels.rotation) == 90) {
	                                            var labelWidth = parseInt(this.options.labels.style.lineHeight) + 2;
	                                            var plotAreaWidth = parseInt(this.chart.plotBox.width);
	                                            var labelsCount = Math.floor(plotAreaWidth / labelWidth);
	                                            if (event.max !== null && event.max !== undefined) {
	                                              var pointsCount = Math.round(event.max - event.min);
	                                            } else {
	                                              var pointsCount = Math.round(this.dataMax - this.dataMin);
	                                            }
	                                            var step = Math.ceil(pointsCount / (labelsCount * (this.tickInterval == null ? 1 : this.tickInterval)));
	                                            this.update({'labels': {'step': step}}, true);
	                                          }
	                                        }
	                                      }
	                                } ],
	                                yAxis : [
	                                        { // Primary yAxis
	                                            labels : {
	                                                format : '{value}',
	                                                style : {
	                                                    color : '#0066FF'
	                                                    /* Highcharts
	                                                            .getOptions().colors[2] */
	                                                }
	                                            },
	                                            title : {
	                                                text : 'Transaction Count',
	                                                style : {
	                                                    color : '#0066FF'
	                                                        /* Highcharts
	                                                        .getOptions().colors[2] */
	                                                }
	                                            },
	                                            opposite : false

	                                        },
	                                        { // Secondary yAxis
	                                            gridLineWidth : 0,
	                                            title : {
	                                                text : '% Requests meeting SLAs',
	                                                style : {
	                                                    color : '#0066FF'
	                                                        /* Highcharts
	                                                        .getOptions().colors[2] */
	                                                }
	                                            },
	                                            labels : {
	                                                format : '{value} %',
	                                                style : {
	                                                    color : '#0066FF'
	                                                        /* Highcharts
	                                                        .getOptions().colors[2] */
	                                                }
	                                            },
	                                            endOnTick: false,
	                                            opposite : true,
	                                            max : 100

	                                        }],
	                                tooltip : {
	                                    shared : true
	                                },
	                                /* legend : {
	                                    layout : 'vertical',
	                                    align : 'right',
	                                    x : 450,
	                                    verticalAlign : 'top',
	                                    y : 120,
	                                    floating : true,
	                                    backgroundColor : (Highcharts.theme && Highcharts.theme.legendBackgroundColor)
	                                            || '#FFFFFF'
	                                }, */
	                                series : [
	                                        {
	                                            name : 'Transaction Count',
	                                            type : 'column',
	                                            yAxis : 0,
	                                            data : transactionVolumes,
	                                            tooltip : {
	                                                valueSuffix : ''
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla 600ms',
	                                            color: 'red',
	                                            type : 'line',
	                                            yAxis : 1,
	                                            data : percReqInSLAs,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla 700ms',
	                                            color: 'green',
	                                            type : 'line',
	                                            yAxis : 1,
	                                            data : percRequestsInSLAValue2,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla 800ms',
	                                            color: 'purple',
	                                            type : 'line',
	                                            yAxis : 1,
	                                            data : percRequestsInSLAValue3,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla 900ms',
	                                            color: 'brown',
	                                            type : 'line',
	                                            yAxis : 1,
	                                            data : percRequestsInSLAValue4,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }

	                                        },
	                                        {
	                                            name : 'Sla',
	                                            color: 'blue',
	                                            type : 'line',
	                                            dashStyle: 'ShortDot',
	                                            yAxis : 1,
	                                            data : sla,
	                                            marker : {
	                                                enabled : false
	                                            },
	                                            tooltip : {
	                                                valueSuffix : ' %'
	                                            }
	                                        }],
                                    		exporting: {                                	        
                                    			sourceWidth: 1300,
                                    			sourceHeight: 600
                                    		}
	                            });
	                    
	                }
					/*Start Multiple Export*/
					
					/**
					 * Create a global getSVG method that takes an array of charts as an argument. The SVG is returned as an argument in the callback.
					 */
					Highcharts.getSVG = function(charts, options, callback) {
						var svgArr = [],
								top = 0,
							width = 0,
							i,
							svgResult = function (svgres) {
								var svg = svgres.replace('<svg', '<g transform="translate(0,' + top + ')" ');
								svg = svg.replace('</svg>', '</g>');
								top += charts[i].chartHeight;
								width = Math.max(width, charts[i].chartWidth);
								svgArr.push(svg);
								if (svgArr.length === charts.length) {
								  callback('<svg height="'+ top +'" width="' + width + '" version="1.1" xmlns="http://www.w3.org/2000/svg">' + svgArr.join('') + '</svg>');
								}
							};
							for (i = 0; i < charts.length; ++i) {
									charts[i].getSVGForLocalExport(options, {}, function () { 
								console.log("Failed to get SVG");
							}, svgResult);
							}
					};

					/**
					 * Create a global exportCharts method that takes an array of charts as an argument,
					 * and exporting options as the second argument
					 */
					Highcharts.exportCharts = function(charts, options) {
							// Merge the options
						options = Highcharts.merge(Highcharts.getOptions().exporting, options);    
							
						var imageType = options && options.type || 'image/jpg';
					  
							// Get SVG asynchronously and then download the resulting SVG
						Highcharts.getSVG(charts, options, function (svg) {
							Highcharts.downloadSVGLocal(svg,
							(options.filename || 'chart')  + '.' + (imageType === 'image/svg+xml' ? 'svg' : imageType.split('/')[1]),
							imageType,
							options.scale || 2,
							function () {
							  console.log("Failed to export on client side");
							});
						});
					};

					$('#export').click(function() {						
						Highcharts.exportCharts([ussdDailyChart, ussdHourlyChart, ppfeDailyChart, ppfeHourlyChart, ccrDailyChart, ccrHourlyChart]);
					});
					
					/*End Multiple Export*/    
	            
			});
			/*]]>*/
		</script>
	</th:block>
</body>
</html>
